<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10.3 Forecasting Stock Price Movement using ML | R for Data Analytics</title>
  <meta name="description" content="This is a collection of examples on using R for Data Analytics" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="10.3 Forecasting Stock Price Movement using ML | R for Data Analytics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of examples on using R for Data Analytics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10.3 Forecasting Stock Price Movement using ML | R for Data Analytics" />
  
  <meta name="twitter:description" content="This is a collection of examples on using R for Data Analytics" />
  

<meta name="author" content="Abhay Singh" />


<meta name="date" content="2021-07-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="rforda.png" type="image/x-icon" />
<link rel="prev" href="10-2-k-nearest-neighbour.html"/>
<link rel="next" href="11-decision-trees-using-r.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="libs/wordcloud2-0.0.1/hover.js"></script>
<script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>Part I</b></span></li>
<li class="chapter" data-level="1" data-path="1-what-is-r.html"><a href="1-what-is-r.html"><i class="fa fa-check"></i><b>1</b> What is R?</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1-1-why-should-we-learn-r.html"><a href="1-1-why-should-we-learn-r.html"><i class="fa fa-check"></i><b>1.1</b> Why should we learn R?</a></li>
<li class="chapter" data-level="1.2" data-path="1-2-Rinstall.html"><a href="1-2-Rinstall.html"><i class="fa fa-check"></i><b>1.2</b> Installing R and RStudio on Windows</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-rstudio-guiide.html"><a href="1-3-rstudio-guiide.html"><i class="fa fa-check"></i><b>1.3</b> RStudio GUI/IDE</a></li>
<li class="chapter" data-level="1.4" data-path="1-4-installing-packages.html"><a href="1-4-installing-packages.html"><i class="fa fa-check"></i><b>1.4</b> Installing Packages</a></li>
<li class="chapter" data-level="1.5" data-path="1-5-getting-help.html"><a href="1-5-getting-help.html"><i class="fa fa-check"></i><b>1.5</b> Getting Help</a></li>
<li class="chapter" data-level="1.6" data-path="1-6-task-views-in-r-introduction-installation.html"><a href="1-6-task-views-in-r-introduction-installation.html"><i class="fa fa-check"></i><b>1.6</b> Task Views in R-Introduction &amp; Installation</a></li>
<li class="chapter" data-level="1.7" data-path="1-7-r-core-packages.html"><a href="1-7-r-core-packages.html"><i class="fa fa-check"></i><b>1.7</b> R core packages</a></li>
<li class="chapter" data-level="1.8" data-path="1-8-example-1-hello-r.html"><a href="1-8-example-1-hello-r.html"><i class="fa fa-check"></i><b>1.8</b> Example-1 Hello R!</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-r-data-types-and-data-structures.html"><a href="2-r-data-types-and-data-structures.html"><i class="fa fa-check"></i><b>2</b> R Data Types and Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-1-data-types.html"><a href="2-1-data-types.html"><i class="fa fa-check"></i><b>2.1</b> Data Types</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="2-1-data-types.html"><a href="2-1-data-types.html#double"><i class="fa fa-check"></i><b>2.1.1</b> Double</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-1-data-types.html"><a href="2-1-data-types.html#integer"><i class="fa fa-check"></i><b>2.1.2</b> Integer</a></li>
<li class="chapter" data-level="2.1.3" data-path="2-1-data-types.html"><a href="2-1-data-types.html#logical"><i class="fa fa-check"></i><b>2.1.3</b> Logical</a></li>
<li class="chapter" data-level="2.1.4" data-path="2-1-data-types.html"><a href="2-1-data-types.html#character"><i class="fa fa-check"></i><b>2.1.4</b> Character</a></li>
<li class="chapter" data-level="2.1.5" data-path="2-1-data-types.html"><a href="2-1-data-types.html#factor"><i class="fa fa-check"></i><b>2.1.5</b> Factor</a></li>
<li class="chapter" data-level="2.1.6" data-path="2-1-data-types.html"><a href="2-1-data-types.html#date-time"><i class="fa fa-check"></i><b>2.1.6</b> Date &amp; Time</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html"><i class="fa fa-check"></i><b>2.2</b> Data Structures in R</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html#vector"><i class="fa fa-check"></i><b>2.2.1</b> Vector</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html#matrices"><i class="fa fa-check"></i><b>2.2.2</b> Matrices</a></li>
<li class="chapter" data-level="2.2.3" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html#arrays"><i class="fa fa-check"></i><b>2.2.3</b> Arrays</a></li>
<li class="chapter" data-level="2.2.4" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="2-2-data-structures-in-r.html"><a href="2-2-data-structures-in-r.html#lists"><i class="fa fa-check"></i><b>2.2.5</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html"><i class="fa fa-check"></i><b>2.3</b> Data Import/Export in R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html#reading-data-from-a-text-file"><i class="fa fa-check"></i><b>2.3.1</b> Reading Data from a Text File</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html#reading-data-from-csv-files"><i class="fa fa-check"></i><b>2.3.2</b> Reading Data from CSV files</a></li>
<li class="chapter" data-level="2.3.3" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html#reading-from-excel-files"><i class="fa fa-check"></i><b>2.3.3</b> Reading from Excel Files</a></li>
<li class="chapter" data-level="2.3.4" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html#reading-from-data-files-from-other-statistical-systems"><i class="fa fa-check"></i><b>2.3.4</b> Reading from Data Files from other Statistical Systems</a></li>
<li class="chapter" data-level="2.3.5" data-path="2-3-data-importexport-in-r.html"><a href="2-3-data-importexport-in-r.html#importing-data-using-rstudio"><i class="fa fa-check"></i><b>2.3.5</b> Importing Data using RStudio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-r-programming-short-introduction.html"><a href="3-r-programming-short-introduction.html"><i class="fa fa-check"></i><b>3</b> R Programming - Short Introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-1-programming-control-flow.html"><a href="3-1-programming-control-flow.html"><i class="fa fa-check"></i><b>3.1</b> Programming Control Flow</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-programming-control-flow.html"><a href="3-1-programming-control-flow.html#if-else-conditional-statements"><i class="fa fa-check"></i><b>3.1.1</b> if-else Conditional Statements</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-programming-control-flow.html"><a href="3-1-programming-control-flow.html#loops"><i class="fa fa-check"></i><b>3.1.2</b> Loops</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-programming-control-flow.html"><a href="3-1-programming-control-flow.html#mathttwhile-loop"><i class="fa fa-check"></i><b>3.1.3</b> <span class="math inline">\(\mathtt{while}\)</span> loop</a></li>
<li class="chapter" data-level="3.1.4" data-path="3-1-programming-control-flow.html"><a href="3-1-programming-control-flow.html#mathttrepeat-loop"><i class="fa fa-check"></i><b>3.1.4</b> <span class="math inline">\(\mathtt{repeat}\)</span> loop</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-functions-in-r.html"><a href="3-2-functions-in-r.html"><i class="fa fa-check"></i><b>3.2</b> Functions in R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-data-exploration.html"><a href="4-data-exploration.html"><i class="fa fa-check"></i><b>4</b> Data Exploration</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-1-data-preprocessing.html"><a href="4-1-data-preprocessing.html"><i class="fa fa-check"></i><b>4.1</b> Data Preprocessing</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-data-preprocessing.html"><a href="4-1-data-preprocessing.html#extracting-data"><i class="fa fa-check"></i><b>4.1.1</b> Extracting Data</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-data-preprocessing.html"><a href="4-1-data-preprocessing.html#combining-data-frames"><i class="fa fa-check"></i><b>4.1.2</b> Combining Data Frames</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-1-data-preprocessing.html"><a href="4-1-data-preprocessing.html#sub-setting-and-logical-data-selection"><i class="fa fa-check"></i><b>4.1.3</b> Sub setting and Logical Data Selection</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-data-transformation-from-wide-to-long-or-vice-versa.html"><a href="4-2-data-transformation-from-wide-to-long-or-vice-versa.html"><i class="fa fa-check"></i><b>4.2</b> Data Transformation from Wide to Long (or vice versa)</a></li>
<li class="chapter" data-level="4.3" data-path="4-3-summary-statistics.html"><a href="4-3-summary-statistics.html"><i class="fa fa-check"></i><b>4.3</b> Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="4-3-summary-statistics.html"><a href="4-3-summary-statistics.html#example-descriptive-statistics-of-stock-returns"><i class="fa fa-check"></i><b>4.3.1</b> Example-Descriptive Statistics of Stock Returns</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-graphics-in-r-part-i.html"><a href="5-graphics-in-r-part-i.html"><i class="fa fa-check"></i><b>5</b> Graphics in R (Part-I)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html"><i class="fa fa-check"></i><b>5.1</b> Basic Plots in R</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html#scatter-plot"><i class="fa fa-check"></i><b>5.1.1</b> Scatter Plot</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html#line-plot"><i class="fa fa-check"></i><b>5.1.2</b> Line Plot</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html#bar-plot"><i class="fa fa-check"></i><b>5.1.3</b> Bar Plot</a></li>
<li class="chapter" data-level="5.1.4" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html#pie-chart"><i class="fa fa-check"></i><b>5.1.4</b> Pie Chart</a></li>
<li class="chapter" data-level="5.1.5" data-path="5-1-basic-plots-in-r.html"><a href="5-1-basic-plots-in-r.html#scatter-plot-1"><i class="fa fa-check"></i><b>5.1.5</b> Scatter Plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-2-r-graphical-parameters.html"><a href="5-2-r-graphical-parameters.html"><i class="fa fa-check"></i><b>5.2</b> R Graphical Parameters</a></li>
<li class="chapter" data-level="5.3" data-path="5-3-introduction-to-ggplot2.html"><a href="5-3-introduction-to-ggplot2.html"><i class="fa fa-check"></i><b>5.3</b> Introduction to ggplot2</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="5-3-introduction-to-ggplot2.html"><a href="5-3-introduction-to-ggplot2.html#mathttqplot"><i class="fa fa-check"></i><b>5.3.1</b> <span class="math inline">\(\mathtt{qplot}\)</span></a></li>
<li class="chapter" data-level="5.3.2" data-path="5-3-introduction-to-ggplot2.html"><a href="5-3-introduction-to-ggplot2.html#layered-graphics-using-mathttggplot"><i class="fa fa-check"></i><b>5.3.2</b> Layered graphics using <span class="math inline">\(\mathtt{ggplot}\)</span></a></li>
<li class="chapter" data-level="5.3.3" data-path="5-3-introduction-to-ggplot2.html"><a href="5-3-introduction-to-ggplot2.html#arranging-plots-using-gridextra"><i class="fa fa-check"></i><b>5.3.3</b> Arranging plots using gridExtra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-graphics-in-r-part-ii.html"><a href="6-graphics-in-r-part-ii.html"><i class="fa fa-check"></i><b>6</b> Graphics in R (Part-II)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-1-interactive-plots-using-plotly.html"><a href="6-1-interactive-plots-using-plotly.html"><i class="fa fa-check"></i><b>6.1</b> Interactive Plots using Plotly</a></li>
<li class="chapter" data-level="6.2" data-path="6-2-animation-using-gganimate.html"><a href="6-2-animation-using-gganimate.html"><i class="fa fa-check"></i><b>6.2</b> Animation using gganimate</a></li>
<li class="chapter" data-level="6.3" data-path="6-3-plot-maps.html"><a href="6-3-plot-maps.html"><i class="fa fa-check"></i><b>6.3</b> Plot Maps</a></li>
</ul></li>
<li class="part"><span><b>Part II</b></span></li>
<li class="chapter" data-level="7" data-path="7-technical-analysis-using-r.html"><a href="7-technical-analysis-using-r.html"><i class="fa fa-check"></i><b>7</b> Technical Analysis using R</a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-1-technical-analysis-ta-using-r.html"><a href="7-1-technical-analysis-ta-using-r.html"><i class="fa fa-check"></i><b>7.1</b> Technical Analysis (TA) using R</a></li>
<li class="chapter" data-level="7.2" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html"><i class="fa fa-check"></i><b>7.2</b> Technical Charts</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html#candlesticks-and-ohlc-chart"><i class="fa fa-check"></i><b>7.2.1</b> Candlesticks and OHLC chart</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html#line-chart"><i class="fa fa-check"></i><b>7.2.2</b> Line chart</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html#candlestick-chart"><i class="fa fa-check"></i><b>7.2.3</b> Candlestick chart</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html#add-technical-indicators"><i class="fa fa-check"></i><b>7.2.4</b> Add technical indicators</a></li>
<li class="chapter" data-level="7.2.5" data-path="7-2-technical-charts.html"><a href="7-2-technical-charts.html#adding-indicators-sequentially"><i class="fa fa-check"></i><b>7.2.5</b> Adding indicators sequentially</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-3-investment-beta-using-r-single-index-model.html"><a href="7-3-investment-beta-using-r-single-index-model.html"><i class="fa fa-check"></i><b>7.3</b> Investment <span class="math inline">\(\beta\)</span> using R (Single Index Model)</a></li>
<li class="chapter" data-level="7.4" data-path="7-4-data-preprocessing-1.html"><a href="7-4-data-preprocessing-1.html"><i class="fa fa-check"></i><b>7.4</b> Data preprocessing</a></li>
<li class="chapter" data-level="7.5" data-path="7-5-visualisation.html"><a href="7-5-visualisation.html"><i class="fa fa-check"></i><b>7.5</b> Visualisation</a></li>
<li class="chapter" data-level="7.6" data-path="7-6-regression-analysis-using-lm.html"><a href="7-6-regression-analysis-using-lm.html"><i class="fa fa-check"></i><b>7.6</b> Regression analysis using lm</a></li>
<li class="chapter" data-level="7.7" data-path="7-7-value-at-risk.html"><a href="7-7-value-at-risk.html"><i class="fa fa-check"></i><b>7.7</b> Value at Risk</a></li>
<li class="chapter" data-level="7.8" data-path="7-8-volatility-modelling-forecasting-using-garch.html"><a href="7-8-volatility-modelling-forecasting-using-garch.html"><i class="fa fa-check"></i><b>7.8</b> Volatility Modelling &amp; Forecasting using GARCH</a></li>
<li class="chapter" data-level="7.9" data-path="7-9-garch11-to-forecast-var.html"><a href="7-9-garch11-to-forecast-var.html"><i class="fa fa-check"></i><b>7.9</b> GARCH(1,1) to forecast VaR</a></li>
<li class="chapter" data-level="7.10" data-path="7-10-var-forecasts-using-out-of-sample.html"><a href="7-10-var-forecasts-using-out-of-sample.html"><i class="fa fa-check"></i><b>7.10</b> VaR forecasts using out of sample</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-portfolio-modelling-using-r.html"><a href="8-portfolio-modelling-using-r.html"><i class="fa fa-check"></i><b>8</b> Portfolio Modelling using R</a></li>
<li class="part"><span><b>Part III</b></span></li>
<li class="chapter" data-level="9" data-path="9-machine-learning-using-r-introduction-to-data-splitting-sampling-resampling.html"><a href="9-machine-learning-using-r-introduction-to-data-splitting-sampling-resampling.html"><i class="fa fa-check"></i><b>9</b> Machine Learning using R-Introduction to Data Splitting, Sampling &amp; Resampling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="9-1-machine-learning-process-quick-intro.html"><a href="9-1-machine-learning-process-quick-intro.html"><i class="fa fa-check"></i><b>9.1</b> Machine Learning Process (Quick Intro)</a></li>
<li class="chapter" data-level="9.2" data-path="9-2-data-splitting-sampling.html"><a href="9-2-data-splitting-sampling.html"><i class="fa fa-check"></i><b>9.2</b> Data Splitting: Sampling</a></li>
<li class="chapter" data-level="9.3" data-path="9-3-random-sampling.html"><a href="9-3-random-sampling.html"><i class="fa fa-check"></i><b>9.3</b> Random Sampling</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="9-3-random-sampling.html"><a href="9-3-random-sampling.html#base-r"><i class="fa fa-check"></i><b>9.3.1</b> Base R</a></li>
<li class="chapter" data-level="9.3.2" data-path="9-3-random-sampling.html"><a href="9-3-random-sampling.html#using-the-caret-package"><i class="fa fa-check"></i><b>9.3.2</b> Using the <code>caret</code> package</a></li>
<li class="chapter" data-level="9.3.3" data-path="9-3-random-sampling.html"><a href="9-3-random-sampling.html#using-the-rsample-package"><i class="fa fa-check"></i><b>9.3.3</b> Using the <code>rsample</code> package</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="9-4-stratified-sampling.html"><a href="9-4-stratified-sampling.html"><i class="fa fa-check"></i><b>9.4</b> Stratified Sampling</a></li>
<li class="chapter" data-level="9.5" data-path="9-5-resampling.html"><a href="9-5-resampling.html"><i class="fa fa-check"></i><b>9.5</b> Resampling</a></li>
<li class="chapter" data-level="9.6" data-path="9-6-k-fold-cross-validation.html"><a href="9-6-k-fold-cross-validation.html"><i class="fa fa-check"></i><b>9.6</b> K-fold Cross Validation</a>
<ul>
<li class="chapter" data-level="" data-path="9-6-k-fold-cross-validation.html"><a href="9-6-k-fold-cross-validation.html#k-fold-cv-in-r"><i class="fa fa-check"></i>K-fold CV in R</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="9-7-cv-for-time-sereis-data.html"><a href="9-7-cv-for-time-sereis-data.html"><i class="fa fa-check"></i><b>9.7</b> CV for time sereis data</a>
<ul>
<li class="chapter" data-level="" data-path="9-7-cv-for-time-sereis-data.html"><a href="9-7-cv-for-time-sereis-data.html#cv-for-time-series-in-r"><i class="fa fa-check"></i>CV for time series in R</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="9-8-bootstrapping.html"><a href="9-8-bootstrapping.html"><i class="fa fa-check"></i><b>9.8</b> Bootstrapping</a>
<ul>
<li class="chapter" data-level="" data-path="9-8-bootstrapping.html"><a href="9-8-bootstrapping.html#bootsrapping-in-r"><i class="fa fa-check"></i>Bootsrapping in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-logistic-regression-k-nearest-neighbour-knn-for-classification.html"><a href="10-logistic-regression-k-nearest-neighbour-knn-for-classification.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression &amp; K-Nearest Neighbour (kNN) for Classification</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-1-logistic-regression.html"><a href="10-1-logistic-regression.html"><i class="fa fa-check"></i><b>10.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="10.2" data-path="10-2-k-nearest-neighbour.html"><a href="10-2-k-nearest-neighbour.html"><i class="fa fa-check"></i><b>10.2</b> K-Nearest Neighbour</a>
<ul>
<li class="chapter" data-level="" data-path="10-2-k-nearest-neighbour.html"><a href="10-2-k-nearest-neighbour.html#nearest-neighbour-classification-quick-introduction"><i class="fa fa-check"></i>Nearest Neighbour classification (Quick Introduction)</a></li>
<li class="chapter" data-level="" data-path="10-2-k-nearest-neighbour.html"><a href="10-2-k-nearest-neighbour.html#k-nn-algorithm"><i class="fa fa-check"></i>k-NN Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="10-3-forecasting-stock-price-movement-using-ml.html"><a href="10-3-forecasting-stock-price-movement-using-ml.html"><i class="fa fa-check"></i><b>10.3</b> Forecasting Stock Price Movement using ML</a>
<ul>
<li class="chapter" data-level="" data-path="10-3-forecasting-stock-price-movement-using-ml.html"><a href="10-3-forecasting-stock-price-movement-using-ml.html#data-indicators"><i class="fa fa-check"></i>Data &amp; Indicators</a></li>
<li class="chapter" data-level="" data-path="10-3-forecasting-stock-price-movement-using-ml.html"><a href="10-3-forecasting-stock-price-movement-using-ml.html#visualise-the-data"><i class="fa fa-check"></i>Visualise the data</a></li>
<li class="chapter" data-level="10.3.1" data-path="10-3-forecasting-stock-price-movement-using-ml.html"><a href="10-3-forecasting-stock-price-movement-using-ml.html#using-logistic-regression"><i class="fa fa-check"></i><b>10.3.1</b> Using Logistic Regression</a></li>
<li class="chapter" data-level="10.3.2" data-path="10-3-forecasting-stock-price-movement-using-ml.html"><a href="10-3-forecasting-stock-price-movement-using-ml.html#using-k-nn"><i class="fa fa-check"></i><b>10.3.2</b> Using K-NN</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-decision-trees-using-r.html"><a href="11-decision-trees-using-r.html"><i class="fa fa-check"></i><b>11</b> Decision Trees using R</a>
<ul>
<li class="chapter" data-level="11.1" data-path="11-1-import-data-and-pre-processing.html"><a href="11-1-import-data-and-pre-processing.html"><i class="fa fa-check"></i><b>11.1</b> Import Data and Pre-processing</a></li>
<li class="chapter" data-level="11.2" data-path="11-2-visualisation-some-features.html"><a href="11-2-visualisation-some-features.html"><i class="fa fa-check"></i><b>11.2</b> Visualisation some features</a></li>
<li class="chapter" data-level="11.3" data-path="11-3-creating-training-and-testing-set-and-control.html"><a href="11-3-creating-training-and-testing-set-and-control.html"><i class="fa fa-check"></i><b>11.3</b> Creating Training and Testing Set and Control</a></li>
<li class="chapter" data-level="11.4" data-path="11-4-train-the-model-on-the-training-set.html"><a href="11-4-train-the-model-on-the-training-set.html"><i class="fa fa-check"></i><b>11.4</b> Train the model on the training set</a></li>
<li class="chapter" data-level="11.5" data-path="11-5-prediction-and-accuracy.html"><a href="11-5-prediction-and-accuracy.html"><i class="fa fa-check"></i><b>11.5</b> Prediction and Accuracy</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="11-5-prediction-and-accuracy.html"><a href="11-5-prediction-and-accuracy.html#model-1"><i class="fa fa-check"></i><b>11.5.1</b> Model-1</a></li>
<li class="chapter" data-level="11.5.2" data-path="11-5-prediction-and-accuracy.html"><a href="11-5-prediction-and-accuracy.html#model-2"><i class="fa fa-check"></i><b>11.5.2</b> Model-2</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="11-6-feature-interpretation.html"><a href="11-6-feature-interpretation.html"><i class="fa fa-check"></i><b>11.6</b> Feature Interpretation</a></li>
<li class="chapter" data-level="11.7" data-path="11-7-tree-visualisation.html"><a href="11-7-tree-visualisation.html"><i class="fa fa-check"></i><b>11.7</b> Tree visualisation</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-text-mining-using-r.html"><a href="12-text-mining-using-r.html"><i class="fa fa-check"></i><b>12</b> Text Mining using R</a>
<ul>
<li class="chapter" data-level="12.1" data-path="12-1-introduction-to-text-mining.html"><a href="12-1-introduction-to-text-mining.html"><i class="fa fa-check"></i><b>12.1</b> Introduction to Text Mining</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="12-1-introduction-to-text-mining.html"><a href="12-1-introduction-to-text-mining.html#text-data"><i class="fa fa-check"></i><b>12.1.1</b> Text Data</a></li>
<li class="chapter" data-level="12.1.2" data-path="12-1-introduction-to-text-mining.html"><a href="12-1-introduction-to-text-mining.html#generic-text-mining-system"><i class="fa fa-check"></i><b>12.1.2</b> Generic Text Mining System</a></li>
<li class="chapter" data-level="12.1.3" data-path="12-1-introduction-to-text-mining.html"><a href="12-1-introduction-to-text-mining.html#data-pre-processing-in-text-mining"><i class="fa fa-check"></i><b>12.1.3</b> Data pre-processing in Text Mining</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="12-2-mining-twitter-text-data-using-r.html"><a href="12-2-mining-twitter-text-data-using-r.html"><i class="fa fa-check"></i><b>12.2</b> Mining Twitter Text Data using R</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="12-2-mining-twitter-text-data-using-r.html"><a href="12-2-mining-twitter-text-data-using-r.html#obtaining-twitter-data"><i class="fa fa-check"></i><b>12.2.1</b> Obtaining Twitter Data</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="12-3-download-data.html"><a href="12-3-download-data.html"><i class="fa fa-check"></i><b>12.3</b> Download Data</a></li>
<li class="chapter" data-level="12.4" data-path="12-4-data-pre-processing.html"><a href="12-4-data-pre-processing.html"><i class="fa fa-check"></i><b>12.4</b> Data Pre-processing</a></li>
<li class="chapter" data-level="12.5" data-path="12-5-some-visualisation.html"><a href="12-5-some-visualisation.html"><i class="fa fa-check"></i><b>12.5</b> Some Visualisation</a></li>
<li class="chapter" data-level="12.6" data-path="12-6-sentiment-analysis.html"><a href="12-6-sentiment-analysis.html"><i class="fa fa-check"></i><b>12.6</b> Sentiment Analysis</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="12-6-sentiment-analysis.html"><a href="12-6-sentiment-analysis.html#method"><i class="fa fa-check"></i><b>12.6.1</b> Method</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="12-7-topic-modelling.html"><a href="12-7-topic-modelling.html"><i class="fa fa-check"></i><b>12.7</b> Topic Modelling</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-work-in-progress.html"><a href="13-work-in-progress.html"><i class="fa fa-check"></i><b>13</b> Work in Progress</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li> <img src="firebrick3RA_img.png" height="60" width="60" style="position:bottom:0px;right:0px;"/></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forecasting-stock-price-movement-using-ml" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Forecasting Stock Price Movement using ML</h2>
<p>Topic-7 provided an introduction to using R for creating Technical Indicators for traded assets. This example uses selected indicators to predict the direction of the price movement, i.e., if the prices will be higher or lower the next day. Various studies have evaluated ML methods to predict the price direction or return, for example, <span class="citation"><a href="#ref-Shynkevich2017" role="doc-biblioref">Shynkevich et al.</a> (<a href="#ref-Shynkevich2017" role="doc-biblioref">2017</a>)</span> examined indicators like SMA, EMA etc on various forecast horizons and window lengths.</p>
<ul>
<li><p>The example will use the closing prices of a stock (BHP in this case) to create the following Technical Indicators</p></li>
<li><p>Lag of 5 Days Simple Moving Average : Moving averages are the simplest among all indicators: they show the average price level for you on a rolling basis.</p></li>
<li><p>Lag 5 Days Exponential Moving Average: The difference between SMA and EMA is that SMA weighs all candles equally whereas EMA gives exponential weights – hence the name: it overweights recent days to previous ones.</p></li>
<li><p>MACD: Moving Average Convergence Divergence: Uses EMA of 26 and 12 days. Designed to reveal changes in strength, direction, momentum and duration of a trend in stock price.</p></li>
<li><p>Lag of Log Returns</p></li>
<li><p>Lag of RSI: Momentum oscillator that measures the speed and change of price movements. Ranges from zero to 100. Can be used to identify general trends.</p></li>
<li><p>The response (dependent) variable is constructed based on the previous day(s) prices. Here we use the following indicator:</p></li>
</ul>
<span class="math display" id="eq:ind1">\[\begin{equation}

1 \rightarrow P_{t}\geq P_{t-5}\\
0\, otherswise
 
\tag{10.3}

\end{equation}\]</span>
<div id="data-indicators" class="section level3 unnumbered">
<h3>Data &amp; Indicators</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb1-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TTR)</span>
<span id="cb1-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)  <span class="co">#required as the data was saved as an xts object</span></span>
<span id="cb1-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-4" aria-hidden="true" tabindex="-1"></a>d_bhp <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/bhp_prices.rds&quot;</span>)</span>
<span id="cb1-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-5" aria-hidden="true" tabindex="-1"></a>d_bhp <span class="ot">=</span> d_bhp<span class="sc">$</span>BHP.AX.Close  <span class="co">#select close prices</span></span>
<span id="cb1-6"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d_bhp) <span class="ot">=</span> <span class="st">&quot;Price&quot;</span></span>
<span id="cb1-7"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># SMA</span></span>
<span id="cb1-10"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-10" aria-hidden="true" tabindex="-1"></a>sma5 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">SMA</span>(d_bhp, <span class="at">n =</span> <span class="dv">5</span>))  <span class="co">#notice the use of the lag function to take lagged values</span></span>
<span id="cb1-11"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># EMA</span></span>
<span id="cb1-12"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-12" aria-hidden="true" tabindex="-1"></a>ema5 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">EMA</span>(d_bhp, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb1-13"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># MACD</span></span>
<span id="cb1-14"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-14" aria-hidden="true" tabindex="-1"></a>macd1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">MACD</span>(d_bhp))</span>
<span id="cb1-15"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># RSI</span></span>
<span id="cb1-16"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-16" aria-hidden="true" tabindex="-1"></a>rsi1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">RSI</span>(d_bhp, <span class="dv">5</span>))</span>
<span id="cb1-17"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># log returns</span></span>
<span id="cb1-18"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-18" aria-hidden="true" tabindex="-1"></a>ret1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">dailyReturn</span>(d_bhp, <span class="at">type =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb1-19"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># price director indicator</span></span>
<span id="cb1-21"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb1-22" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">=</span> <span class="fu">ifelse</span>(d_bhp<span class="sc">$</span>Price <span class="sc">&gt;=</span> <span class="fu">lag</span>(d_bhp<span class="sc">$</span>Price, <span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co">#direction variable compared to  5 day before price</span></span></code></pre></div>
<ul>
<li>Combine all the indicators and response variable in a data frame</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb2-1" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">cbind</span>(dir, ret1, sma5, ema5, macd1, rsi1)</span>
<span id="cb2-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names</span></span>
<span id="cb2-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d_ex1) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Direction&quot;</span>, <span class="st">&quot;Ret&quot;</span>, <span class="st">&quot;SMA&quot;</span>, <span class="st">&quot;EMA&quot;</span>, <span class="st">&quot;MACD&quot;</span>, <span class="st">&quot;Signal&quot;</span>,</span>
<span id="cb2-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;RSI&quot;</span>)</span></code></pre></div>
</div>
<div id="visualise-the-data" class="section level3 unnumbered">
<h3>Visualise the data</h3>
<ul>
<li>Using the quantmod package</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(d_bhp, <span class="at">theme =</span> <span class="st">&quot;white&quot;</span>, <span class="at">name =</span> <span class="st">&quot;BHP Closing Prices and Indicators&quot;</span>)</span>
<span id="cb3-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addTA</span>(d_ex1[, <span class="dv">1</span>], <span class="at">col =</span> <span class="dv">1</span>, <span class="at">legend =</span> <span class="st">&quot;Direction&quot;</span>)  <span class="co">#Direction</span></span>
<span id="cb3-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addTA</span>(d_ex1[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">on =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">6</span>), <span class="at">legend =</span> <span class="fu">as.character</span>(<span class="fu">colnames</span>(d_ex1[,</span>
<span id="cb3-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span>])))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-4-1.png" alt="Direction and Technical Indicators" width="672" />
<p class="caption">
Figure 10.1: Direction and Technical Indicators
</p>
</div>
<ul>
<li>The above graph can be improved using ggplot2</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataset and convert data to long</span></span>
<span id="cb4-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-4" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">merge.xts</span>(d_bhp, d_ex1)</span>
<span id="cb4-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NAs and then convert to long</span></span>
<span id="cb4-6"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-7" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">na.omit</span>(d_plot)</span>
<span id="cb4-8"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to dataframe</span></span>
<span id="cb4-9"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-9" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Date =</span> <span class="fu">index</span>(d_plot), <span class="fu">coredata</span>(d_plot))</span>
<span id="cb4-10"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-10" aria-hidden="true" tabindex="-1"></a>d_plot_long <span class="ot">=</span> <span class="fu">pivot_longer</span>(d_plot, <span class="sc">-</span><span class="fu">c</span>(Date, Direction), <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb4-11"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Indicator&quot;</span>)</span>
<span id="cb4-12"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># change direction to a factor</span></span>
<span id="cb4-14"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-14" aria-hidden="true" tabindex="-1"></a>d_plot_long<span class="sc">$</span>Direction <span class="ot">=</span> <span class="fu">as.factor</span>(d_plot_long<span class="sc">$</span>Direction)</span>
<span id="cb4-15"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-16" aria-hidden="true" tabindex="-1"></a>(<span class="at">p2_ex =</span> <span class="fu">ggplot</span>(d_plot_long, <span class="fu">aes</span>(Date, value, <span class="at">color =</span> Indicator)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-17"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Indicator <span class="sc">~</span> ., <span class="at">scale =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>())</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-5-1.png" alt="Indicators and Prices (ggplot2)" width="672" />
<p class="caption">
Figure 10.2: Indicators and Prices (ggplot2)
</p>
</div>
<ul>
<li>The above is a line chart of indicators and prices. We can also create a box plot to visualise the variance in the values relative to the direction</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb5-1" aria-hidden="true" tabindex="-1"></a>p2_ex <span class="ot">=</span> <span class="fu">ggplot</span>(d_plot_long, <span class="fu">aes</span>(value, Indicator, <span class="at">fill =</span> Direction)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span>
<span id="cb5-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb5-4" aria-hidden="true" tabindex="-1"></a>p2_ex <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;TA Indicators vs Price Direction&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Price Direction&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;lightblue&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-6"></span>
<img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-6-1.png" alt="Box Plot of Indicators" width="672" />
<p class="caption">
Figure 10.3: Box Plot of Indicators
</p>
</div>
<ul>
<li>Some differences per category can be noticed</li>
</ul>
</div>
<div id="using-logistic-regression" class="section level3" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Using Logistic Regression</h3>
<ul>
<li>70:30 data split</li>
<li>Time series sampling
<ul>
<li>Stratified sampling will not keep the time order and hence its avoided</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NAs</span></span>
<span id="cb6-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-2" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">na.omit</span>(d_ex1)</span>
<span id="cb6-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to data frame</span></span>
<span id="cb6-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-4" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">as.data.frame</span>(d_ex1)</span>
<span id="cb6-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert direction to a factor for classification</span></span>
<span id="cb6-6"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-7" aria-hidden="true" tabindex="-1"></a>d_ex1<span class="sc">$</span>Direction <span class="ot">=</span> <span class="fu">as.factor</span>(d_ex1<span class="sc">$</span>Direction)</span>
<span id="cb6-8"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-9" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(d_ex1) <span class="sc">*</span> <span class="fl">0.7</span>))  <span class="co">#create index for first 70% values to be in the testing set</span></span>
<span id="cb6-10"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-10" aria-hidden="true" tabindex="-1"></a>d_train1 <span class="ot">=</span> d_ex1[idx1, ]  <span class="co">#training set</span></span>
<span id="cb6-11"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb6-11" aria-hidden="true" tabindex="-1"></a>d_test1 <span class="ot">=</span> d_ex1[<span class="sc">-</span>idx1, ]  <span class="co">#testing set</span></span></code></pre></div>
<p><strong>Training Setup</strong></p>
<ul>
<li>Time series cross validate for resampling: 250 day window 30 days for prediction (this can be changed)</li>
<li>Data preprocessing is conducted to normalise the scale of the values</li>
<li><code>glm</code> method with binomial family for the binary classification</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb7-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb7-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># control</span></span>
<span id="cb7-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-4" aria-hidden="true" tabindex="-1"></a>cntrl1 <span class="ot">=</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;timeslice&quot;</span>, <span class="at">initialWindow =</span> <span class="dv">250</span>, <span class="at">horizon =</span> <span class="dv">30</span>,</span>
<span id="cb7-5"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixedWindow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-6"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># preprocesing</span></span>
<span id="cb7-7"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-7" aria-hidden="true" tabindex="-1"></a>prep1 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>)</span>
<span id="cb7-8"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic regression</span></span>
<span id="cb7-9"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-9" aria-hidden="true" tabindex="-1"></a>logit_ex1 <span class="ot">=</span> <span class="fu">train</span>(Direction <span class="sc">~</span> ., <span class="at">data =</span> d_train1, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb7-10"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cntrl1, <span class="at">preProcess =</span> prep1)</span>
<span id="cb7-11"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb7-11" aria-hidden="true" tabindex="-1"></a>logit_ex1  <span class="co">#final model accuracy</span></span></code></pre></div>
<pre><code>Generalized Linear Model 

434 samples
  6 predictor
  2 classes: &#39;0&#39;, &#39;1&#39; 

Pre-processing: centered (6), scaled (6) 
Resampling: Rolling Forecasting Origin Resampling (30 held-out with a fixed window) 
Summary of sample sizes: 250, 250, 250, 250, 250, 250, ... 
Resampling results:

  Accuracy   Kappa    
  0.7711828  0.4982703</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_ex1<span class="sc">$</span>finalModel)  <span class="co">#summary of the final model</span></span></code></pre></div>
<pre><code>
Call:
NULL

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.1642  -0.4752   0.1207   0.4923   2.3637  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)   0.2040     0.1447   1.410    0.158    
Ret          -0.2710     0.2261  -1.198    0.231    
SMA         -27.3260     5.9692  -4.578 4.70e-06 ***
EMA          27.1922     5.9461   4.573 4.81e-06 ***
MACD          0.4719     1.1980   0.394    0.694    
Signal       -0.7815     0.9917  -0.788    0.431    
RSI           2.1482     0.5440   3.949 7.86e-05 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 600.54  on 433  degrees of freedom
Residual deviance: 310.82  on 427  degrees of freedom
AIC: 324.82

Number of Fisher Scoring iterations: 6</code></pre>
<ul>
<li>Variable importance</li>
<li>In the case of multiple predictor variables, we want to understand which variable is the most influential in predicting the response variable.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb11-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vip</span>(logit_ex1, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-9-1.png" alt="Variable Importance" width="672" />
<p class="caption">
Figure 10.4: Variable Importance
</p>
</div>
<p><strong>Predictive Accuracy</strong></p>
<ul>
<li>ML models should be checked for predictive accuracy on the test set</li>
<li>caret provides <code>predict</code> function to create predictions</li>
<li>These predictions can be assessed based on the confusion matrix</li>
</ul>
<p><strong>Confusion Matrix</strong>
- When applying classification models, we often use a confusion matrix to evaluate certain performance measures.</p>
<ul>
<li><p>A confusion matrix is simply a matrix that compares actual categorical levels (or events) to the predicted categorical levels.</p></li>
<li><p>Prediction of the right level; refer to this as a true positive.</p></li>
<li><p>Prediction of a level or event that did not happen this is called a false positive (i.e. we predicted a customer would redeem a coupon and they did not).</p></li>
<li><p>Alternatively, when we do not predict a level or event and it does happen that this is called a false negative (i.e. a customer that we did not predict to redeem a coupon does).</p></li>
<li><p>Let’s predict using the final model and assess using the confusion matrix.</p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb12-1" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">=</span> <span class="fu">predict</span>(logit_ex1, <span class="at">newdata =</span> d_test1)  <span class="co">#prediction on the test data</span></span>
<span id="cb12-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred1, <span class="at">reference =</span> d_test1<span class="sc">$</span>Direction)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 65 17
         1 22 82
                                          
               Accuracy : 0.7903          
                 95% CI : (0.7247, 0.8464)
    No Information Rate : 0.5323          
    P-Value [Acc &gt; NIR] : 2.293e-13       
                                          
                  Kappa : 0.5774          
                                          
 Mcnemar&#39;s Test P-Value : 0.5218          
                                          
            Sensitivity : 0.7471          
            Specificity : 0.8283          
         Pos Pred Value : 0.7927          
         Neg Pred Value : 0.7885          
             Prevalence : 0.4677          
         Detection Rate : 0.3495          
   Detection Prevalence : 0.4409          
      Balanced Accuracy : 0.7877          
                                          
       &#39;Positive&#39; Class : 0               
                                          </code></pre>
<ul>
<li>The model provides decent accuracy which is higher than the No Information Rate and also statistically significant.</li>
</ul>
<p>There are other analyses which can be conducted on logistic regression, for example, ROC (Receiver Operating Characteristic) curve analysis for the Area Under the Curve.</p>
</div>
<div id="using-k-nn" class="section level3" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Using K-NN</h3>
<ul>
<li>This section will implement the previous model using k-nearest neigbour algorithm using the caret package</li>
<li>Then we will use the same split as the logistic regression</li>
<li>We are selecting the model based on Accuracy &amp; Kappa</li>
<li>Accuracy: Accuracy measures the overall correctness of the classifier <span class="math inline">\(\frac{(TN+TP)}{Total}\)</span>. Objective: maximise</li>
<li>Kappa (Cohen’s Kappa): Its like Accuracy but it is normalised at the baseline of random chance on the dataset. It compares observed accuracy to expected accuracy.</li>
<li>A grid search is used to search for an optimal value for k</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb14-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb14-2" aria-hidden="true" tabindex="-1"></a>grid1 <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>))  <span class="co">#to search from k=1 to k=10 </span></span>
<span id="cb14-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb14-3" aria-hidden="true" tabindex="-1"></a>knn_ex1 <span class="ot">=</span> <span class="fu">train</span>(Direction <span class="sc">~</span> ., <span class="at">data =</span> d_train1, <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="at">tuneGrid =</span> grid1,</span>
<span id="cb14-4"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cntrl1, <span class="at">preProcess =</span> prep1)</span></code></pre></div>
<ul>
<li>View the fit</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn_ex1)  <span class="co">#may suggest using a wider grid</span></span></code></pre></div>
<p><img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb16-1" aria-hidden="true" tabindex="-1"></a>knn_ex1</span></code></pre></div>
<pre><code>k-Nearest Neighbors 

434 samples
  6 predictor
  2 classes: &#39;0&#39;, &#39;1&#39; 

Pre-processing: centered (6), scaled (6) 
Resampling: Rolling Forecasting Origin Resampling (30 held-out with a fixed window) 
Summary of sample sizes: 250, 250, 250, 250, 250, 250, ... 
Resampling results across tuning parameters:

  k  Accuracy   Kappa    
  1  0.6492473  0.2964789
  3  0.6694624  0.3516452
  5  0.7055914  0.3710057
  7  0.7122581  0.3792520
  9  0.7191398  0.3964104

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 9.</code></pre>
<p><em>Variable importance can’t be obtained here as KNN does not produce a model</em></p>
<p><strong>Predictive Accuracy</strong></p>
<p>Let’s predict using the final model and assess using the confusion matrix.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb18-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">=</span> <span class="fu">predict</span>(knn_ex1, <span class="at">newdata =</span> d_test1)  <span class="co">#prediction on the test data</span></span>
<span id="cb18-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred2, <span class="at">reference =</span> d_test1<span class="sc">$</span>Direction)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 62 21
         1 25 78
                                          
               Accuracy : 0.7527          
                 95% CI : (0.6842, 0.8129)
    No Information Rate : 0.5323          
    P-Value [Acc &gt; NIR] : 4.896e-10       
                                          
                  Kappa : 0.5019          
                                          
 Mcnemar&#39;s Test P-Value : 0.6583          
                                          
            Sensitivity : 0.7126          
            Specificity : 0.7879          
         Pos Pred Value : 0.7470          
         Neg Pred Value : 0.7573          
             Prevalence : 0.4677          
         Detection Rate : 0.3333          
   Detection Prevalence : 0.4462          
      Balanced Accuracy : 0.7503          
                                          
       &#39;Positive&#39; Class : 0               
                                          </code></pre>
<ul>
<li><p>A comparison betweek Logistic Regression and KNN can be made based on their predictive accuracy.</p></li>
<li><p>The two models can also be compared based on their resampling results.</p></li>
<li><p>The random number seeds should be initialised to the same value for resampling comparison.</p></li>
<li><p>The following code compares the model fits.</p></li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb20-1" aria-hidden="true" tabindex="-1"></a>resamp1 <span class="ot">=</span> <span class="fu">resamples</span>(<span class="fu">list</span>(<span class="at">logit =</span> logit_ex1, <span class="at">knn =</span> knn_ex1))</span>
<span id="cb20-2"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resamp1)</span></code></pre></div>
<pre><code>
Call:
summary.resamples(object = resamp1)

Models: logit, knn 
Number of resamples: 155 

Accuracy 
           Min.   1st Qu.    Median      Mean   3rd Qu. Max. NA&#39;s
logit 0.5666667 0.7333333 0.7666667 0.7711828 0.8333333  0.9    0
knn   0.5333333 0.6666667 0.7333333 0.7191398 0.8000000  0.9    0

Kappa 
            Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
logit -0.2745098 0.4666667 0.5414847 0.4982703 0.6270974 0.7345133    0
knn   -0.2000000 0.2811483 0.4104803 0.3964104 0.5720385 0.7945205    0</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="10-3-forecasting-stock-price-movement-using-ml.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(resamp1, <span class="at">metric =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-14"></span>
<img src="04-Part_3_logistic_files/figure-html/unnamed-chunk-14-1.png" alt="Resample Accuracy comparison" width="672" />
<p class="caption">
Figure 10.5: Resample Accuracy comparison
</p>
</div>
<ul>
<li>The graph provides a comparison of the overall accuracy of the model (not the predictions).</li>
</ul>

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Shynkevich2017" class="csl-entry">
Shynkevich, Yauheniya, T. M. McGinnity, Sonya A. Coleman, Ammar Belatreche, and Yuhua Li. 2017. <span>“Forecasting Price Movements Using Technical Indicators: Investigating the Impact of Varying Input Window Length.”</span> <em>Neurocomputing</em> 264: 71–88. https://doi.org/<a href="https://doi.org/10.1016/j.neucom.2016.11.095">https://doi.org/10.1016/j.neucom.2016.11.095</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="10-2-k-nearest-neighbour.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="11-decision-trees-using-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
