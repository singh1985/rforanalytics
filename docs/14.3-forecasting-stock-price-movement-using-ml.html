<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14.3 Forecasting Stock Price Movement using ML | R for Data Analytics</title>
  <meta name="description" content="This is a collection of examples on using R for Data Analytics" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="14.3 Forecasting Stock Price Movement using ML | R for Data Analytics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of examples on using R for Data Analytics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14.3 Forecasting Stock Price Movement using ML | R for Data Analytics" />
  
  <meta name="twitter:description" content="This is a collection of examples on using R for Data Analytics" />
  

<meta name="author" content="Abhay Singh" />


<meta name="date" content="2022-11-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="rforda.png" type="image/x-icon" />
<link rel="prev" href="14.2-k-nearest-neighbour.html"/>
<link rel="next" href="15-decision-trees-using-r.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="libs/wordcloud2-0.0.1/hover.js"></script>
<script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Data Analytics</a></li>

<li class="divider"></li>
<li><a href="index.html#preface" id="toc-preface">Preface</a></li>
<li><a href="#part-part-i" id="toc-part-part-i">(PART*) Part I</a></li>
<li><a href="1-what-is-r.html#what-is-r" id="toc-what-is-r"><span class="toc-section-number">1</span> What is R?</a>
<ul>
<li><a href="1.1-why-should-we-learn-r.html#why-should-we-learn-r" id="toc-why-should-we-learn-r"><span class="toc-section-number">1.1</span> Why should we learn R?</a></li>
<li><a href="1.2-Rinstall.html#Rinstall" id="toc-Rinstall"><span class="toc-section-number">1.2</span> Installing R and RStudio on Windows</a></li>
<li><a href="1.3-rstudio-guiide.html#rstudio-guiide" id="toc-rstudio-guiide"><span class="toc-section-number">1.3</span> RStudio GUI/IDE</a></li>
<li><a href="1.4-installing-packages.html#installing-packages" id="toc-installing-packages"><span class="toc-section-number">1.4</span> Installing Packages</a></li>
<li><a href="1.5-getting-help.html#getting-help" id="toc-getting-help"><span class="toc-section-number">1.5</span> Getting Help</a></li>
<li><a href="1.6-task-views-in-r-introduction-installation.html#task-views-in-r-introduction-installation" id="toc-task-views-in-r-introduction-installation"><span class="toc-section-number">1.6</span> Task Views in R-Introduction &amp; Installation</a></li>
<li><a href="1.7-r-core-packages.html#r-core-packages" id="toc-r-core-packages"><span class="toc-section-number">1.7</span> R core packages</a></li>
<li><a href="1.8-example-1-hello-r.html#example-1-hello-r" id="toc-example-1-hello-r"><span class="toc-section-number">1.8</span> Example-1 Hello R!</a></li>
</ul></li>
<li><a href="2-r-data-types-and-data-structures.html#r-data-types-and-data-structures" id="toc-r-data-types-and-data-structures"><span class="toc-section-number">2</span> R Data Types and Data Structures</a>
<ul>
<li><a href="2.1-data-types.html#data-types" id="toc-data-types"><span class="toc-section-number">2.1</span> Data Types</a>
<ul>
<li><a href="2.1-data-types.html#double" id="toc-double"><span class="toc-section-number">2.1.1</span> Double</a></li>
<li><a href="2.1-data-types.html#integer" id="toc-integer"><span class="toc-section-number">2.1.2</span> Integer</a></li>
<li><a href="2.1-data-types.html#logical" id="toc-logical"><span class="toc-section-number">2.1.3</span> Logical</a></li>
<li><a href="2.1-data-types.html#character" id="toc-character"><span class="toc-section-number">2.1.4</span> Character</a></li>
<li><a href="2.1-data-types.html#factor" id="toc-factor"><span class="toc-section-number">2.1.5</span> Factor</a></li>
<li><a href="2.1-data-types.html#date-time" id="toc-date-time"><span class="toc-section-number">2.1.6</span> Date &amp; Time</a></li>
</ul></li>
<li><a href="2.2-data-structures-in-r.html#data-structures-in-r" id="toc-data-structures-in-r"><span class="toc-section-number">2.2</span> Data Structures in R</a>
<ul>
<li><a href="2.2-data-structures-in-r.html#vector" id="toc-vector"><span class="toc-section-number">2.2.1</span> Vector</a></li>
<li><a href="2.2-data-structures-in-r.html#matrices" id="toc-matrices"><span class="toc-section-number">2.2.2</span> Matrices</a></li>
<li><a href="2.2-data-structures-in-r.html#arrays" id="toc-arrays"><span class="toc-section-number">2.2.3</span> Arrays</a></li>
<li><a href="2.2-data-structures-in-r.html#data-frames" id="toc-data-frames"><span class="toc-section-number">2.2.4</span> Data Frames</a></li>
<li><a href="2.2-data-structures-in-r.html#lists" id="toc-lists"><span class="toc-section-number">2.2.5</span> Lists</a></li>
</ul></li>
<li><a href="2.3-data-importexport-in-r.html#data-importexport-in-r" id="toc-data-importexport-in-r"><span class="toc-section-number">2.3</span> Data Import/Export in R</a>
<ul>
<li><a href="2.3-data-importexport-in-r.html#reading-data-from-a-text-file" id="toc-reading-data-from-a-text-file"><span class="toc-section-number">2.3.1</span> Reading Data from a Text File</a></li>
<li><a href="2.3-data-importexport-in-r.html#reading-data-from-csv-files" id="toc-reading-data-from-csv-files"><span class="toc-section-number">2.3.2</span> Reading Data from CSV files</a></li>
<li><a href="2.3-data-importexport-in-r.html#reading-from-excel-files" id="toc-reading-from-excel-files"><span class="toc-section-number">2.3.3</span> Reading from Excel Files</a></li>
<li><a href="2.3-data-importexport-in-r.html#reading-from-data-files-from-other-statistical-systems" id="toc-reading-from-data-files-from-other-statistical-systems"><span class="toc-section-number">2.3.4</span> Reading from Data Files from other Statistical Systems</a></li>
<li><a href="2.3-data-importexport-in-r.html#importing-data-using-rstudio" id="toc-importing-data-using-rstudio"><span class="toc-section-number">2.3.5</span> Importing Data using RStudio</a></li>
</ul></li>
</ul></li>
<li><a href="3-r-programming---short-introduction.html#r-programming---short-introduction" id="toc-r-programming---short-introduction"><span class="toc-section-number">3</span> R Programming - Short Introduction</a>
<ul>
<li><a href="3.1-programming-control-flow.html#programming-control-flow" id="toc-programming-control-flow"><span class="toc-section-number">3.1</span> Programming Control Flow</a>
<ul>
<li><a href="3.1-programming-control-flow.html#if-else-conditional-statements" id="toc-if-else-conditional-statements"><span class="toc-section-number">3.1.1</span> if-else Conditional Statements</a></li>
<li><a href="3.1-programming-control-flow.html#loops" id="toc-loops"><span class="toc-section-number">3.1.2</span> Loops</a></li>
<li><a href="3.1-programming-control-flow.html#mathttwhile-loop" id="toc-mathttwhile-loop"><span class="toc-section-number">3.1.3</span> <span class="math inline">\(\mathtt{while}\)</span> loop</a></li>
<li><a href="3.1-programming-control-flow.html#mathttrepeat-loop" id="toc-mathttrepeat-loop"><span class="toc-section-number">3.1.4</span> <span class="math inline">\(\mathtt{repeat}\)</span> loop</a></li>
</ul></li>
<li><a href="3.2-functions-in-r.html#functions-in-r" id="toc-functions-in-r"><span class="toc-section-number">3.2</span> Functions in R</a></li>
</ul></li>
<li><a href="4-data-exploration.html#data-exploration" id="toc-data-exploration"><span class="toc-section-number">4</span> Data Exploration</a>
<ul>
<li><a href="4.1-data-preprocessing.html#data-preprocessing" id="toc-data-preprocessing"><span class="toc-section-number">4.1</span> Data Preprocessing</a>
<ul>
<li><a href="4.1-data-preprocessing.html#extracting-data" id="toc-extracting-data"><span class="toc-section-number">4.1.1</span> Extracting Data</a></li>
<li><a href="4.1-data-preprocessing.html#combining-data-frames" id="toc-combining-data-frames"><span class="toc-section-number">4.1.2</span> Combining Data Frames</a></li>
<li><a href="4.1-data-preprocessing.html#sub-setting-and-logical-data-selection" id="toc-sub-setting-and-logical-data-selection"><span class="toc-section-number">4.1.3</span> Sub setting and Logical Data Selection</a></li>
</ul></li>
<li><a href="4.2-data-transformation-from-wide-to-long-or-vice-versa.html#data-transformation-from-wide-to-long-or-vice-versa" id="toc-data-transformation-from-wide-to-long-or-vice-versa"><span class="toc-section-number">4.2</span> Data Transformation from Wide to Long (or vice versa)</a></li>
<li><a href="4.3-summary-statistics.html#summary-statistics" id="toc-summary-statistics"><span class="toc-section-number">4.3</span> Summary Statistics</a>
<ul>
<li><a href="4.3-summary-statistics.html#example-descriptive-statistics-of-stock-returns" id="toc-example-descriptive-statistics-of-stock-returns"><span class="toc-section-number">4.3.1</span> Example-Descriptive Statistics of Stock Returns</a></li>
</ul></li>
</ul></li>
<li><a href="5-graphics-in-r-part-i.html#graphics-in-r-part-i" id="toc-graphics-in-r-part-i"><span class="toc-section-number">5</span> Graphics in R (Part-I)</a>
<ul>
<li><a href="5.1-basic-plots-in-r.html#basic-plots-in-r" id="toc-basic-plots-in-r"><span class="toc-section-number">5.1</span> Basic Plots in R</a>
<ul>
<li><a href="5.1-basic-plots-in-r.html#scatter-plot" id="toc-scatter-plot"><span class="toc-section-number">5.1.1</span> Scatter Plot</a></li>
<li><a href="5.1-basic-plots-in-r.html#line-plot" id="toc-line-plot"><span class="toc-section-number">5.1.2</span> Line Plot</a></li>
<li><a href="5.1-basic-plots-in-r.html#bar-plot" id="toc-bar-plot"><span class="toc-section-number">5.1.3</span> Bar Plot</a></li>
<li><a href="5.1-basic-plots-in-r.html#pie-chart" id="toc-pie-chart"><span class="toc-section-number">5.1.4</span> Pie Chart</a></li>
<li><a href="5.1-basic-plots-in-r.html#scatter-plot-1" id="toc-scatter-plot-1"><span class="toc-section-number">5.1.5</span> Scatter Plot</a></li>
</ul></li>
<li><a href="5.2-r-graphical-parameters.html#r-graphical-parameters" id="toc-r-graphical-parameters"><span class="toc-section-number">5.2</span> R Graphical Parameters</a></li>
<li><a href="5.3-introduction-to-ggplot2.html#introduction-to-ggplot2" id="toc-introduction-to-ggplot2"><span class="toc-section-number">5.3</span> Introduction to ggplot2</a>
<ul>
<li><a href="5.3-introduction-to-ggplot2.html#mathttqplot" id="toc-mathttqplot"><span class="toc-section-number">5.3.1</span> <span class="math inline">\(\mathtt{qplot}\)</span></a></li>
<li><a href="5.3-introduction-to-ggplot2.html#layered-graphics-using-mathttggplot" id="toc-layered-graphics-using-mathttggplot"><span class="toc-section-number">5.3.2</span> Layered graphics using <span class="math inline">\(\mathtt{ggplot}\)</span></a></li>
<li><a href="5.3-introduction-to-ggplot2.html#arranging-plots-using-gridextra" id="toc-arranging-plots-using-gridextra"><span class="toc-section-number">5.3.3</span> Arranging plots using gridExtra</a></li>
</ul></li>
</ul></li>
<li><a href="6-graphics-in-r-part-ii.html#graphics-in-r-part-ii" id="toc-graphics-in-r-part-ii"><span class="toc-section-number">6</span> Graphics in R (Part-II)</a>
<ul>
<li><a href="6.1-interactive-plots-using-plotly.html#interactive-plots-using-plotly" id="toc-interactive-plots-using-plotly"><span class="toc-section-number">6.1</span> Interactive Plots using Plotly</a></li>
<li><a href="6.2-animation-using-gganimate.html#animation-using-gganimate" id="toc-animation-using-gganimate"><span class="toc-section-number">6.2</span> Animation using gganimate</a></li>
<li><a href="6.3-plot-maps.html#plot-maps" id="toc-plot-maps"><span class="toc-section-number">6.3</span> Plot Maps</a></li>
</ul></li>
<li><a href="#part-part-ii" id="toc-part-part-ii">(PART*) Part II</a></li>
<li><a href="7-linear-regression.html#linear-regression" id="toc-linear-regression"><span class="toc-section-number">7</span> Linear Regression</a>
<ul>
<li><a href="7.1-investment-beta-using-r-single-index-model.html#investment-beta-using-r-single-index-model" id="toc-investment-beta-using-r-single-index-model"><span class="toc-section-number">7.1</span> Investment <span class="math inline">\(\beta\)</span> using R (Single Index Model)</a></li>
<li><a href="7.2-data-preprocessing-1.html#data-preprocessing-1" id="toc-data-preprocessing-1"><span class="toc-section-number">7.2</span> Data preprocessing</a></li>
<li><a href="7.3-visualisation.html#visualisation" id="toc-visualisation"><span class="toc-section-number">7.3</span> Visualisation</a></li>
<li><a href="7.4-regression-analysis-using-lm.html#regression-analysis-using-lm" id="toc-regression-analysis-using-lm"><span class="toc-section-number">7.4</span> Regression analysis using lm</a></li>
</ul></li>
<li><a href="8-multiple-regression.html#multiple-regression" id="toc-multiple-regression"><span class="toc-section-number">8</span> Multiple Regression</a>
<ul>
<li><a href="8.1-fama-french-three-factor-model.html#fama-french-three-factor-model" id="toc-fama-french-three-factor-model"><span class="toc-section-number">8.1</span> Fama-French Three Factor Model</a>
<ul>
<li><a href="8.1-fama-french-three-factor-model.html#data-preprocessing-2" id="toc-data-preprocessing-2"><span class="toc-section-number">8.1.1</span> Data Preprocessing</a></li>
<li><a href="8.1-fama-french-three-factor-model.html#regression-analysis" id="toc-regression-analysis"><span class="toc-section-number">8.1.2</span> Regression Analysis</a></li>
<li><a href="8.1-fama-french-three-factor-model.html#visualisation-1" id="toc-visualisation-1"><span class="toc-section-number">8.1.3</span> Visualisation</a></li>
</ul></li>
</ul></li>
<li><a href="9-panel-regression.html#panel-regression" id="toc-panel-regression"><span class="toc-section-number">9</span> Panel Regression</a>
<ul>
<li><a href="9.1-fixed-and-random-effects-using-the-plm-package.html#fixed-and-random-effects-using-the-plm-package" id="toc-fixed-and-random-effects-using-the-plm-package"><span class="toc-section-number">9.1</span> Fixed and Random effects using the <code>plm</code> package</a></li>
<li><a href="9.2-fixed-effects-model.html#fixed-effects-model" id="toc-fixed-effects-model"><span class="toc-section-number">9.2</span> Fixed Effects Model</a></li>
<li><a href="9.3-random-effects-model.html#random-effects-model" id="toc-random-effects-model"><span class="toc-section-number">9.3</span> Random Effects Model</a></li>
<li><a href="9.4-testing.html#testing" id="toc-testing"><span class="toc-section-number">9.4</span> Testing</a>
<ul>
<li><a href="9.4-testing.html#panel-or-ols" id="toc-panel-or-ols"><span class="toc-section-number">9.4.1</span> Panel or OLS</a></li>
<li><a href="9.4-testing.html#fixed-effect-or-random-effect" id="toc-fixed-effect-or-random-effect"><span class="toc-section-number">9.4.2</span> Fixed Effect or Random Effect</a></li>
</ul></li>
</ul></li>
<li><a href="10-technical-analysis-using-r.html#technical-analysis-using-r" id="toc-technical-analysis-using-r"><span class="toc-section-number">10</span> Technical Analysis using R</a>
<ul>
<li><a href="10.1-technical-analysis-ta-using-r.html#technical-analysis-ta-using-r" id="toc-technical-analysis-ta-using-r"><span class="toc-section-number">10.1</span> Technical Analysis (TA) using R</a></li>
<li><a href="10.2-technical-charts.html#technical-charts" id="toc-technical-charts"><span class="toc-section-number">10.2</span> Technical Charts</a>
<ul>
<li><a href="10.2-technical-charts.html#candlesticks-and-ohlc-chart" id="toc-candlesticks-and-ohlc-chart"><span class="toc-section-number">10.2.1</span> Candlesticks and OHLC chart</a></li>
<li><a href="10.2-technical-charts.html#line-chart" id="toc-line-chart"><span class="toc-section-number">10.2.2</span> Line chart</a></li>
<li><a href="10.2-technical-charts.html#candlestick-chart" id="toc-candlestick-chart"><span class="toc-section-number">10.2.3</span> Candlestick chart</a></li>
<li><a href="10.2-technical-charts.html#add-technical-indicators" id="toc-add-technical-indicators"><span class="toc-section-number">10.2.4</span> Add technical indicators</a></li>
<li><a href="10.2-technical-charts.html#adding-indicators-sequentially" id="toc-adding-indicators-sequentially"><span class="toc-section-number">10.2.5</span> Adding indicators sequentially</a></li>
</ul></li>
</ul></li>
<li><a href="11-forecasting-var-using-garch-models.html#forecasting-var-using-garch-models" id="toc-forecasting-var-using-garch-models"><span class="toc-section-number">11</span> Forecasting VaR using GARCH Models</a>
<ul>
<li><a href="11.1-value-at-risk.html#value-at-risk" id="toc-value-at-risk"><span class="toc-section-number">11.1</span> Value at Risk</a></li>
<li><a href="11.2-volatility-modelling-forecasting-using-garch.html#volatility-modelling-forecasting-using-garch" id="toc-volatility-modelling-forecasting-using-garch"><span class="toc-section-number">11.2</span> Volatility Modelling &amp; Forecasting using GARCH</a></li>
<li><a href="11.3-garch11-to-forecast-var.html#garch11-to-forecast-var" id="toc-garch11-to-forecast-var"><span class="toc-section-number">11.3</span> GARCH(1,1) to forecast VaR</a></li>
<li><a href="11.4-var-forecasts-using-out-of-sample.html#var-forecasts-using-out-of-sample" id="toc-var-forecasts-using-out-of-sample"><span class="toc-section-number">11.4</span> VaR forecasts using out of sample</a></li>
</ul></li>
<li><a href="12-portfolio-modelling-using-r.html#portfolio-modelling-using-r" id="toc-portfolio-modelling-using-r"><span class="toc-section-number">12</span> Portfolio Modelling using R</a>
<ul>
<li><a href="12.1-portfolio-analysis-quick-intro.html#portfolio-analysis-quick-intro" id="toc-portfolio-analysis-quick-intro"><span class="toc-section-number">12.1</span> Portfolio Analysis (Quick Intro)</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#mean-variance-portfolio-important-concepts" id="toc-mean-variance-portfolio-important-concepts"><span class="toc-section-number">12.2</span> Mean Variance Portfolio: Important concepts</a>
<ul>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#expected-return" id="toc-expected-return">Expected Return</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#risk" id="toc-risk">Risk</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#covariance-of-returns" id="toc-covariance-of-returns">Covariance of Returns</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#correlation" id="toc-correlation">Correlation</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#portfolio-return" id="toc-portfolio-return">Portfolio Return</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#portfolio-risk" id="toc-portfolio-risk">Portfolio Risk</a></li>
<li><a href="12.2-mean-variance-portfolio-important-concepts.html#portfolio-risk-for-n-assets" id="toc-portfolio-risk-for-n-assets">Portfolio Risk for <em>N</em> Assets</a></li>
</ul></li>
<li><a href="12.3-diversification-markowitz-minimum-variance-portfolio.html#diversification-markowitz-minimum-variance-portfolio" id="toc-diversification-markowitz-minimum-variance-portfolio"><span class="toc-section-number">12.3</span> Diversification &amp; Markowitz Minimum Variance Portfolio</a></li>
<li><a href="12.4-minimum-variance-portfolio.html#minimum-variance-portfolio" id="toc-minimum-variance-portfolio"><span class="toc-section-number">12.4</span> Minimum Variance Portfolio</a>
<ul>
<li><a href="12.4-minimum-variance-portfolio.html#efficient-weights-for-two-assets" id="toc-efficient-weights-for-two-assets"><span class="toc-section-number">12.4.1</span> Efficient Weights for Two Assets</a></li>
<li><a href="12.4-minimum-variance-portfolio.html#portfolio-with-n-risky-assets" id="toc-portfolio-with-n-risky-assets"><span class="toc-section-number">12.4.2</span> Portfolio with N Risky Assets</a></li>
</ul></li>
<li><a href="12.5-using-r-to-construct-multi-asset-portfolio.html#using-r-to-construct-multi-asset-portfolio" id="toc-using-r-to-construct-multi-asset-portfolio"><span class="toc-section-number">12.5</span> Using R to Construct Multi-Asset Portfolio</a>
<ul>
<li><a href="12.5-using-r-to-construct-multi-asset-portfolio.html#data" id="toc-data"><span class="toc-section-number">12.5.1</span> Data</a></li>
<li><a href="12.5-using-r-to-construct-multi-asset-portfolio.html#portfolios-with-random-weights" id="toc-portfolios-with-random-weights"><span class="toc-section-number">12.5.2</span> Portfolios with random weights</a></li>
</ul></li>
<li><a href="12.6-efficient-minimum-variance-portfolio-using-r-packages.html#efficient-minimum-variance-portfolio-using-r-packages" id="toc-efficient-minimum-variance-portfolio-using-r-packages"><span class="toc-section-number">12.6</span> Efficient (Minimum Variance) Portfolio using R packages</a>
<ul>
<li><a href="12.6-efficient-minimum-variance-portfolio-using-r-packages.html#minimum-variance-and-portfolio-for-a-given-level-of-return" id="toc-minimum-variance-and-portfolio-for-a-given-level-of-return"><span class="toc-section-number">12.6.1</span> Minimum Variance and portfolio for a given level of return</a></li>
<li><a href="12.6-efficient-minimum-variance-portfolio-using-r-packages.html#portfolio-with-box-constraints" id="toc-portfolio-with-box-constraints"><span class="toc-section-number">12.6.2</span> Portfolio with Box Constraints</a></li>
</ul></li>
<li><a href="12.7-evaluating-portfoios-risk-adjusted-performance.html#evaluating-portfoios-risk-adjusted-performance" id="toc-evaluating-portfoios-risk-adjusted-performance"><span class="toc-section-number">12.7</span> Evaluating Portfoios: Risk Adjusted Performance</a>
<ul>
<li><a href="12.7-evaluating-portfoios-risk-adjusted-performance.html#sharpe-ratio" id="toc-sharpe-ratio"><span class="toc-section-number">12.7.1</span> Sharpe Ratio</a></li>
<li><a href="12.7-evaluating-portfoios-risk-adjusted-performance.html#roys-safety-ratio" id="toc-roys-safety-ratio"><span class="toc-section-number">12.7.2</span> Roy’s Safety Ratio</a></li>
<li><a href="12.7-evaluating-portfoios-risk-adjusted-performance.html#treynors-ratio" id="toc-treynors-ratio"><span class="toc-section-number">12.7.3</span> Treynor’s Ratio</a></li>
<li><a href="12.7-evaluating-portfoios-risk-adjusted-performance.html#sharpe-ratio-portfolio-in-r" id="toc-sharpe-ratio-portfolio-in-r"><span class="toc-section-number">12.7.4</span> Sharpe Ratio (Portfolio) in R</a></li>
</ul></li>
</ul></li>
<li><a href="#part-part-iii" id="toc-part-part-iii">(PART*) Part III</a></li>
<li><a href="13-machine-learning-using-r-introduction-to-data-splitting-sampling-resampling.html#machine-learning-using-r-introduction-to-data-splitting-sampling-resampling" id="toc-machine-learning-using-r-introduction-to-data-splitting-sampling-resampling"><span class="toc-section-number">13</span> Machine Learning using R-Introduction to Data Splitting, Sampling &amp; Resampling</a>
<ul>
<li><a href="13.1-machine-learning-process-quick-intro.html#machine-learning-process-quick-intro" id="toc-machine-learning-process-quick-intro"><span class="toc-section-number">13.1</span> Machine Learning Process (Quick Intro)</a></li>
<li><a href="13.2-data-splitting-sampling.html#data-splitting-sampling" id="toc-data-splitting-sampling"><span class="toc-section-number">13.2</span> Data Splitting: Sampling</a></li>
<li><a href="13.3-random-sampling.html#random-sampling" id="toc-random-sampling"><span class="toc-section-number">13.3</span> Random Sampling</a>
<ul>
<li><a href="13.3-random-sampling.html#base-r" id="toc-base-r"><span class="toc-section-number">13.3.1</span> Base R</a></li>
<li><a href="13.3-random-sampling.html#using-the-caret-package" id="toc-using-the-caret-package"><span class="toc-section-number">13.3.2</span> Using the <code>caret</code> package</a></li>
<li><a href="13.3-random-sampling.html#using-the-rsample-package" id="toc-using-the-rsample-package"><span class="toc-section-number">13.3.3</span> Using the <code>rsample</code> package</a></li>
</ul></li>
<li><a href="13.4-stratified-sampling.html#stratified-sampling" id="toc-stratified-sampling"><span class="toc-section-number">13.4</span> Stratified Sampling</a></li>
<li><a href="13.5-resampling.html#resampling" id="toc-resampling"><span class="toc-section-number">13.5</span> Resampling</a></li>
<li><a href="13.6-k-fold-cross-validation.html#k-fold-cross-validation" id="toc-k-fold-cross-validation"><span class="toc-section-number">13.6</span> K-fold Cross Validation</a>
<ul>
<li><a href="13.6-k-fold-cross-validation.html#k-fold-cv-in-r" id="toc-k-fold-cv-in-r">K-fold CV in R</a></li>
</ul></li>
<li><a href="13.7-cv-for-time-series-data.html#cv-for-time-series-data" id="toc-cv-for-time-series-data"><span class="toc-section-number">13.7</span> CV for time series data</a>
<ul>
<li><a href="13.7-cv-for-time-series-data.html#cv-for-time-series-in-r" id="toc-cv-for-time-series-in-r">CV for time series in R</a></li>
</ul></li>
<li><a href="13.8-bootstrapping.html#bootstrapping" id="toc-bootstrapping"><span class="toc-section-number">13.8</span> Bootstrapping</a>
<ul>
<li><a href="13.8-bootstrapping.html#bootsrapping-in-r" id="toc-bootsrapping-in-r">Bootsrapping in R</a></li>
</ul></li>
</ul></li>
<li><a href="14-logistic-regression-k-nearest-neighbour-knn-for-classification.html#logistic-regression-k-nearest-neighbour-knn-for-classification" id="toc-logistic-regression-k-nearest-neighbour-knn-for-classification"><span class="toc-section-number">14</span> Logistic Regression &amp; K-Nearest Neighbour (kNN) for Classification</a>
<ul>
<li><a href="14.1-logistic-regression.html#logistic-regression" id="toc-logistic-regression"><span class="toc-section-number">14.1</span> Logistic Regression</a></li>
<li><a href="14.2-k-nearest-neighbour.html#k-nearest-neighbour" id="toc-k-nearest-neighbour"><span class="toc-section-number">14.2</span> K-Nearest Neighbour</a>
<ul>
<li><a href="14.2-k-nearest-neighbour.html#nearest-neighbour-classification-quick-introduction" id="toc-nearest-neighbour-classification-quick-introduction">Nearest Neighbour classification (Quick Introduction)</a></li>
<li><a href="14.2-k-nearest-neighbour.html#k-nn-algorithm" id="toc-k-nn-algorithm">k-NN Algorithm</a></li>
</ul></li>
<li><a href="14.3-forecasting-stock-price-movement-using-ml.html#forecasting-stock-price-movement-using-ml" id="toc-forecasting-stock-price-movement-using-ml"><span class="toc-section-number">14.3</span> Forecasting Stock Price Movement using ML</a>
<ul>
<li><a href="14.3-forecasting-stock-price-movement-using-ml.html#data-indicators" id="toc-data-indicators"><span class="toc-section-number">14.3.1</span> Data &amp; Indicators</a></li>
<li><a href="14.3-forecasting-stock-price-movement-using-ml.html#visualise-the-data" id="toc-visualise-the-data"><span class="toc-section-number">14.3.2</span> Visualise the data</a></li>
<li><a href="14.3-forecasting-stock-price-movement-using-ml.html#using-logistic-regression" id="toc-using-logistic-regression"><span class="toc-section-number">14.3.3</span> Using Logistic Regression</a></li>
<li><a href="14.3-forecasting-stock-price-movement-using-ml.html#using-k-nn" id="toc-using-k-nn"><span class="toc-section-number">14.3.4</span> Using K-NN</a></li>
</ul></li>
</ul></li>
<li><a href="15-decision-trees-using-r.html#decision-trees-using-r" id="toc-decision-trees-using-r"><span class="toc-section-number">15</span> Decision Trees using R</a>
<ul>
<li><a href="15.1-import-data-and-pre-processing.html#import-data-and-pre-processing" id="toc-import-data-and-pre-processing"><span class="toc-section-number">15.1</span> Import Data and Pre-processing</a></li>
<li><a href="15.2-visualisation-some-features.html#visualisation-some-features" id="toc-visualisation-some-features"><span class="toc-section-number">15.2</span> Visualisation some features</a></li>
<li><a href="15.3-creating-training-and-testing-set-and-control.html#creating-training-and-testing-set-and-control" id="toc-creating-training-and-testing-set-and-control"><span class="toc-section-number">15.3</span> Creating Training and Testing Set and Control</a></li>
<li><a href="15.4-train-the-model-on-the-training-set.html#train-the-model-on-the-training-set" id="toc-train-the-model-on-the-training-set"><span class="toc-section-number">15.4</span> Train the model on the training set</a></li>
<li><a href="15.5-prediction-and-accuracy.html#prediction-and-accuracy" id="toc-prediction-and-accuracy"><span class="toc-section-number">15.5</span> Prediction and Accuracy</a>
<ul>
<li><a href="15.5-prediction-and-accuracy.html#model-1" id="toc-model-1"><span class="toc-section-number">15.5.1</span> Model-1</a></li>
<li><a href="15.5-prediction-and-accuracy.html#model-2" id="toc-model-2"><span class="toc-section-number">15.5.2</span> Model-2</a></li>
</ul></li>
<li><a href="15.6-feature-interpretation.html#feature-interpretation" id="toc-feature-interpretation"><span class="toc-section-number">15.6</span> Feature Interpretation</a></li>
<li><a href="15.7-tree-visualisation.html#tree-visualisation" id="toc-tree-visualisation"><span class="toc-section-number">15.7</span> Tree visualisation</a></li>
</ul></li>
<li><a href="16-text-mining-using-r.html#text-mining-using-r" id="toc-text-mining-using-r"><span class="toc-section-number">16</span> Text Mining using R</a>
<ul>
<li><a href="16.1-introduction-to-text-mining.html#introduction-to-text-mining" id="toc-introduction-to-text-mining"><span class="toc-section-number">16.1</span> Introduction to Text Mining</a>
<ul>
<li><a href="16.1-introduction-to-text-mining.html#text-data" id="toc-text-data"><span class="toc-section-number">16.1.1</span> Text Data</a></li>
<li><a href="16.1-introduction-to-text-mining.html#generic-text-mining-system" id="toc-generic-text-mining-system"><span class="toc-section-number">16.1.2</span> Generic Text Mining System</a></li>
<li><a href="16.1-introduction-to-text-mining.html#data-pre-processing-in-text-mining" id="toc-data-pre-processing-in-text-mining"><span class="toc-section-number">16.1.3</span> Data pre-processing in Text Mining</a></li>
</ul></li>
<li><a href="16.2-mining-twitter-text-data-using-r.html#mining-twitter-text-data-using-r" id="toc-mining-twitter-text-data-using-r"><span class="toc-section-number">16.2</span> Mining Twitter Text Data using R</a>
<ul>
<li><a href="16.2-mining-twitter-text-data-using-r.html#obtaining-twitter-data" id="toc-obtaining-twitter-data"><span class="toc-section-number">16.2.1</span> Obtaining Twitter Data</a></li>
</ul></li>
<li><a href="16.3-download-data.html#download-data" id="toc-download-data"><span class="toc-section-number">16.3</span> Download Data</a></li>
<li><a href="16.4-data-pre-processing.html#data-pre-processing" id="toc-data-pre-processing"><span class="toc-section-number">16.4</span> Data Pre-processing</a></li>
<li><a href="16.5-some-visualisation.html#some-visualisation" id="toc-some-visualisation"><span class="toc-section-number">16.5</span> Some Visualisation</a></li>
<li><a href="16.6-sentiment-analysis.html#sentiment-analysis" id="toc-sentiment-analysis"><span class="toc-section-number">16.6</span> Sentiment Analysis</a>
<ul>
<li><a href="16.6-sentiment-analysis.html#method" id="toc-method"><span class="toc-section-number">16.6.1</span> Method</a></li>
</ul></li>
<li><a href="16.7-topic-modelling.html#topic-modelling" id="toc-topic-modelling"><span class="toc-section-number">16.7</span> Topic Modelling</a></li>
</ul></li>
<li><a href="17-work-in-progress.html#work-in-progress" id="toc-work-in-progress"><span class="toc-section-number">17</span> Work in Progress</a></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li> <img src="firebrick3RA_img.png" height="60" width="60" style="position:bottom:0px;right:0px;"/></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forecasting-stock-price-movement-using-ml" class="section level2" number="14.3">
<h2><span class="header-section-number">14.3</span> Forecasting Stock Price Movement using ML</h2>
<p>Topic-7 provided an introduction to using R for creating Technical Indicators for traded assets. This example uses selected indicators to predict the direction of the price movement, i.e., if the prices will be higher or lower the next day. Various studies have evaluated ML methods to predict the price direction or return, for example, <span class="citation">Shynkevich et al. (<a href="#ref-Shynkevich2017" role="doc-biblioref">2017</a>)</span> examined indicators like SMA, EMA etc on various forecast horizons and window lengths.</p>
<ul>
<li><p>The example will use the closing prices of a stock (BHP in this case) to create the following Technical Indicators</p></li>
<li><p>Lag of 5 Days Simple Moving Average : Moving averages are the simplest among all indicators: they show the average price level for you on a rolling basis.</p></li>
<li><p>Lag 5 Days Exponential Moving Average: The difference between SMA and EMA is that SMA weighs all candles equally whereas EMA gives exponential weights – hence the name: it overweights recent days to previous ones.</p></li>
<li><p>MACD: Moving Average Convergence Divergence: Uses EMA of 26 and 12 days. Designed to reveal changes in strength, direction, momentum and duration of a trend in stock price.</p></li>
<li><p>Lag of Log Returns</p></li>
<li><p>Lag of RSI: Momentum oscillator that measures the speed and change of price movements. Ranges from zero to 100. Can be used to identify general trends.</p></li>
<li><p>The response (dependent) variable is constructed based on the previous day(s) prices. Here we use the following indicator:</p></li>
</ul>
<span class="math display" id="eq:ind1">\[\begin{equation}

1 \rightarrow P_{t}\geq P_{t-5}\\
0\, otherswise
\tag{14.3}

\end{equation}\]</span>
<div id="data-indicators" class="section level3" number="14.3.1">
<h3><span class="header-section-number">14.3.1</span> Data &amp; Indicators</h3>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb355-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TTR)</span>
<span id="cb355-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)  <span class="co">#required as the data was saved as an xts object</span></span>
<span id="cb355-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-4" aria-hidden="true" tabindex="-1"></a>d_bhp <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/bhp_prices.rds&quot;</span>)</span>
<span id="cb355-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-5" aria-hidden="true" tabindex="-1"></a>d_bhp <span class="ot">=</span> d_bhp<span class="sc">$</span>BHP.AX.Close  <span class="co">#select close prices</span></span>
<span id="cb355-6"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d_bhp) <span class="ot">=</span> <span class="st">&quot;Price&quot;</span></span>
<span id="cb355-7"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-8"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-9"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-9" aria-hidden="true" tabindex="-1"></a><span class="co"># SMA</span></span>
<span id="cb355-10"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-10" aria-hidden="true" tabindex="-1"></a>sma5 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">SMA</span>(d_bhp, <span class="at">n =</span> <span class="dv">5</span>))  <span class="co">#notice the use of the lag function to take lagged values</span></span>
<span id="cb355-11"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-11" aria-hidden="true" tabindex="-1"></a><span class="co"># EMA</span></span>
<span id="cb355-12"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-12" aria-hidden="true" tabindex="-1"></a>ema5 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">EMA</span>(d_bhp, <span class="at">n =</span> <span class="dv">5</span>))</span>
<span id="cb355-13"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-13" aria-hidden="true" tabindex="-1"></a><span class="co"># MACD</span></span>
<span id="cb355-14"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-14" aria-hidden="true" tabindex="-1"></a>macd1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">MACD</span>(d_bhp))</span>
<span id="cb355-15"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-15" aria-hidden="true" tabindex="-1"></a><span class="co"># RSI</span></span>
<span id="cb355-16"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-16" aria-hidden="true" tabindex="-1"></a>rsi1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">RSI</span>(d_bhp, <span class="dv">5</span>))</span>
<span id="cb355-17"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-17" aria-hidden="true" tabindex="-1"></a><span class="co"># log returns</span></span>
<span id="cb355-18"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-18" aria-hidden="true" tabindex="-1"></a>ret1 <span class="ot">=</span> <span class="fu">lag</span>(<span class="fu">dailyReturn</span>(d_bhp, <span class="at">type =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb355-19"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-20"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-20" aria-hidden="true" tabindex="-1"></a><span class="co"># price director indicator</span></span>
<span id="cb355-21"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-22"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb355-22" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">=</span> <span class="fu">ifelse</span>(d_bhp<span class="sc">$</span>Price <span class="sc">&gt;=</span> <span class="fu">lag</span>(d_bhp<span class="sc">$</span>Price, <span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co">#direction variable compared to  5 day before price</span></span></code></pre></div>
<ul>
<li>Combine all the indicators and response variable in a data frame</li>
</ul>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb356-1" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">cbind</span>(dir, ret1, sma5, ema5, macd1, rsi1)</span>
<span id="cb356-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb356-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names</span></span>
<span id="cb356-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb356-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d_ex1) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Direction&quot;</span>, <span class="st">&quot;Ret&quot;</span>, <span class="st">&quot;SMA&quot;</span>, <span class="st">&quot;EMA&quot;</span>, <span class="st">&quot;MACD&quot;</span>, <span class="st">&quot;Signal&quot;</span>,</span>
<span id="cb356-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb356-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;RSI&quot;</span>)</span></code></pre></div>
</div>
<div id="visualise-the-data" class="section level3" number="14.3.2">
<h3><span class="header-section-number">14.3.2</span> Visualise the data</h3>
<ul>
<li>Using the quantmod package</li>
</ul>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chartSeries</span>(d_bhp, <span class="at">theme =</span> <span class="st">&quot;white&quot;</span>, <span class="at">name =</span> <span class="st">&quot;BHP Closing Prices and Indicators&quot;</span>)</span>
<span id="cb357-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addTA</span>(d_ex1[, <span class="dv">1</span>], <span class="at">col =</span> <span class="dv">1</span>, <span class="at">legend =</span> <span class="st">&quot;Direction&quot;</span>)  <span class="co">#Direction</span></span>
<span id="cb357-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb357-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addTA</span>(d_ex1[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">on =</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">6</span>), <span class="at">legend =</span> <span class="fu">as.character</span>(<span class="fu">colnames</span>(d_ex1[,</span>
<span id="cb357-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb357-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span>])))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f1"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f1-1.png" alt="Direction and Technical Indicators" width="672" />
<p class="caption">
Figure 14.1: Direction and Technical Indicators
</p>
</div>
<ul>
<li>The above graph can be improved using ggplot2</li>
</ul>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb358-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb358-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataset and convert data to long</span></span>
<span id="cb358-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-4" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">merge.xts</span>(d_bhp, d_ex1)</span>
<span id="cb358-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NAs and then convert to long</span></span>
<span id="cb358-6"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-7"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-7" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">na.omit</span>(d_plot)</span>
<span id="cb358-8"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-8" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to dataframe</span></span>
<span id="cb358-9"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-9" aria-hidden="true" tabindex="-1"></a>d_plot <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Date =</span> <span class="fu">index</span>(d_plot), <span class="fu">coredata</span>(d_plot))</span>
<span id="cb358-10"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-10" aria-hidden="true" tabindex="-1"></a>d_plot_long <span class="ot">=</span> <span class="fu">pivot_longer</span>(d_plot, <span class="sc">-</span><span class="fu">c</span>(Date, Direction), <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb358-11"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Indicator&quot;</span>)</span>
<span id="cb358-12"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-13"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-13" aria-hidden="true" tabindex="-1"></a><span class="co"># change direction to a factor</span></span>
<span id="cb358-14"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-14" aria-hidden="true" tabindex="-1"></a>d_plot_long<span class="sc">$</span>Direction <span class="ot">=</span> <span class="fu">as.factor</span>(d_plot_long<span class="sc">$</span>Direction)</span>
<span id="cb358-15"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-16"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-16" aria-hidden="true" tabindex="-1"></a>(<span class="at">p2_ex =</span> <span class="fu">ggplot</span>(d_plot_long, <span class="fu">aes</span>(Date, value, <span class="at">color =</span> Indicator)) <span class="sc">+</span> <span class="fu">geom_path</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb358-17"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb358-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Indicator <span class="sc">~</span> ., <span class="at">scale =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>())</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f2"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f2-1.png" alt="Indicators and Prices (ggplot2)" width="672" />
<p class="caption">
Figure 14.2: Indicators and Prices (ggplot2)
</p>
</div>
<ul>
<li>The above is a line chart of indicators and prices. We can also create a box plot to visualise the variance in the values relative to the direction</li>
</ul>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb359-1" aria-hidden="true" tabindex="-1"></a>p2_ex <span class="ot">=</span> <span class="fu">ggplot</span>(d_plot_long, <span class="fu">aes</span>(value, Indicator, <span class="at">fill =</span> Direction)) <span class="sc">+</span></span>
<span id="cb359-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb359-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span>
<span id="cb359-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb359-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb359-4" aria-hidden="true" tabindex="-1"></a>p2_ex <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;TA Indicators vs Price Direction&quot;</span>) <span class="sc">+</span></span>
<span id="cb359-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb359-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Price Direction&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;lightblue&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f3"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f3-1.png" alt="Box Plot of Indicators" width="672" />
<p class="caption">
Figure 14.3: Box Plot of Indicators
</p>
</div>
<ul>
<li>Some differences per category can be noticed</li>
</ul>
</div>
<div id="using-logistic-regression" class="section level3" number="14.3.3">
<h3><span class="header-section-number">14.3.3</span> Using Logistic Regression</h3>
<ul>
<li>70:30 data split</li>
<li>Time series sampling
<ul>
<li>Stratified sampling will not keep the time order and hence its avoided</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NAs</span></span>
<span id="cb360-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-2" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">na.omit</span>(d_ex1)</span>
<span id="cb360-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to data frame</span></span>
<span id="cb360-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-4" aria-hidden="true" tabindex="-1"></a>d_ex1 <span class="ot">=</span> <span class="fu">as.data.frame</span>(d_ex1)</span>
<span id="cb360-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert direction to a factor for classification</span></span>
<span id="cb360-6"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-7"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-7" aria-hidden="true" tabindex="-1"></a>d_ex1<span class="sc">$</span>Direction <span class="ot">=</span> <span class="fu">as.factor</span>(d_ex1<span class="sc">$</span>Direction)</span>
<span id="cb360-8"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-9"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-9" aria-hidden="true" tabindex="-1"></a>idx1 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(d_ex1) <span class="sc">*</span> <span class="fl">0.7</span>))  <span class="co">#create index for first 70% values to be in the testing set</span></span>
<span id="cb360-10"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-10" aria-hidden="true" tabindex="-1"></a>d_train1 <span class="ot">=</span> d_ex1[idx1, ]  <span class="co">#training set</span></span>
<span id="cb360-11"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb360-11" aria-hidden="true" tabindex="-1"></a>d_test1 <span class="ot">=</span> d_ex1[<span class="sc">-</span>idx1, ]  <span class="co">#testing set</span></span></code></pre></div>
<p><strong>Training Setup</strong></p>
<ul>
<li>Time series cross validate for resampling: 250 day window 30 days for prediction (this can be changed)</li>
<li>Data preprocessing is conducted to normalise the scale of the values</li>
<li><code>glm</code> method with binomial family for the binary classification</li>
</ul>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb361-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb361-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="co"># control</span></span>
<span id="cb361-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-4" aria-hidden="true" tabindex="-1"></a>cntrl1 <span class="ot">=</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">&quot;timeslice&quot;</span>, <span class="at">initialWindow =</span> <span class="dv">250</span>, <span class="at">horizon =</span> <span class="dv">30</span>,</span>
<span id="cb361-5"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fixedWindow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb361-6"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-6" aria-hidden="true" tabindex="-1"></a><span class="co"># preprocesing</span></span>
<span id="cb361-7"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-7" aria-hidden="true" tabindex="-1"></a>prep1 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>)</span>
<span id="cb361-8"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-8" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic regression</span></span>
<span id="cb361-9"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-9" aria-hidden="true" tabindex="-1"></a>logit_ex1 <span class="ot">=</span> <span class="fu">train</span>(Direction <span class="sc">~</span> ., <span class="at">data =</span> d_train1, <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb361-10"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cntrl1, <span class="at">preProcess =</span> prep1)</span>
<span id="cb361-11"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb361-11" aria-hidden="true" tabindex="-1"></a>logit_ex1  <span class="co">#final model accuracy</span></span></code></pre></div>
<pre><code>Generalized Linear Model 

434 samples
  6 predictor
  2 classes: &#39;0&#39;, &#39;1&#39; 

Pre-processing: centered (6), scaled (6) 
Resampling: Rolling Forecasting Origin Resampling (30 held-out with a fixed window) 
Summary of sample sizes: 250, 250, 250, 250, 250, 250, ... 
Resampling results:

  Accuracy   Kappa    
  0.7324731  0.4658076</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit_ex1<span class="sc">$</span>finalModel)  <span class="co">#summary of the final model</span></span></code></pre></div>
<pre><code>
Call:
NULL

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.43299  -0.63007  -0.04745   0.57603   2.49565  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.05772    0.13429  -0.430    0.667    
Ret          -0.82494    0.18720  -4.407 1.05e-05 ***
SMA         -20.20397    3.70217  -5.457 4.83e-08 ***
EMA          20.05707    3.67374   5.460 4.77e-08 ***
MACD          0.50610    0.73203   0.691    0.489    
Signal       -0.94914    0.68541  -1.385    0.166    
RSI           2.14092    0.30037   7.128 1.02e-12 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 601.61  on 433  degrees of freedom
Residual deviance: 348.17  on 427  degrees of freedom
AIC: 362.17

Number of Fisher Scoring iterations: 5</code></pre>
<ul>
<li>Variable importance</li>
<li>In the case of multiple predictor variables, we want to understand which variable is the most influential in predicting the response variable.</li>
</ul>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb365-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vip</span>(logit_ex1, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f4"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f4-1.png" alt="Variable Importance" width="672" />
<p class="caption">
Figure 14.4: Variable Importance
</p>
</div>
<p><strong>Predictive Accuracy</strong></p>
<ul>
<li>ML models should be checked for predictive accuracy on the test set</li>
<li>caret provides <code>predict</code> function to create predictions</li>
<li>These predictions can be assessed based on the confusion matrix</li>
</ul>
<p><strong>Confusion Matrix</strong>
- When applying classification models, we often use a confusion matrix to evaluate certain performance measures.</p>
<ul>
<li><p>A confusion matrix is simply a matrix that compares actual categorical levels (or events) to the predicted categorical levels.</p></li>
<li><p>Prediction of the right level; refer to this as a true positive.</p></li>
<li><p>Prediction of a level or event that did not happen this is called a false positive (i.e. we predicted a customer would redeem a coupon and they did not).</p></li>
<li><p>Alternatively, when we do not predict a level or event and it does happen that this is called a false negative (i.e. a customer that we did not predict to redeem a coupon does).</p></li>
<li><p>Let’s predict using the final model and assess using the confusion matrix.</p></li>
</ul>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb366-1" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">=</span> <span class="fu">predict</span>(logit_ex1, <span class="at">newdata =</span> d_test1)  <span class="co">#prediction on the test data</span></span>
<span id="cb366-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred1, <span class="at">reference =</span> d_test1<span class="sc">$</span>Direction)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 52 26
         1 16 92
                                          
               Accuracy : 0.7742          
                 95% CI : (0.7073, 0.8321)
    No Information Rate : 0.6344          
    P-Value [Acc &gt; NIR] : 2.959e-05       
                                          
                  Kappa : 0.5279          
                                          
 Mcnemar&#39;s Test P-Value : 0.1649          
                                          
            Sensitivity : 0.7647          
            Specificity : 0.7797          
         Pos Pred Value : 0.6667          
         Neg Pred Value : 0.8519          
             Prevalence : 0.3656          
         Detection Rate : 0.2796          
   Detection Prevalence : 0.4194          
      Balanced Accuracy : 0.7722          
                                          
       &#39;Positive&#39; Class : 0               
                                          </code></pre>
<ul>
<li>The model provides decent accuracy which is higher than the No Information Rate and also statistically significant.</li>
</ul>
<p>There are other analyses which can be conducted on logistic regression, for example, ROC (Receiver Operating Characteristic) curve analysis for the Area Under the Curve.</p>
</div>
<div id="using-k-nn" class="section level3" number="14.3.4">
<h3><span class="header-section-number">14.3.4</span> Using K-NN</h3>
<ul>
<li>This section will implement the previous model using k-nearest neigbour algorithm using the caret package</li>
<li>Then we will use the same split as the logistic regression</li>
<li>We are selecting the model based on Accuracy &amp; Kappa</li>
<li>Accuracy: Accuracy measures the overall correctness of the classifier <span class="math inline">\(\frac{(TN+TP)}{Total}\)</span>. Objective: maximise</li>
<li>Kappa (Cohen’s Kappa): Its like Accuracy but it is normalised at the baseline of random chance on the dataset. It compares observed accuracy to expected accuracy.</li>
<li>A grid search is used to search for an optimal value for k</li>
</ul>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb368-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb368-2" aria-hidden="true" tabindex="-1"></a>grid1 <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="dv">2</span>))  <span class="co">#to search from k=1 to k=10 </span></span>
<span id="cb368-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb368-3" aria-hidden="true" tabindex="-1"></a>knn_ex1 <span class="ot">=</span> <span class="fu">train</span>(Direction <span class="sc">~</span> ., <span class="at">data =</span> d_train1, <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="at">tuneGrid =</span> grid1,</span>
<span id="cb368-4"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb368-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cntrl1, <span class="at">preProcess =</span> prep1)</span></code></pre></div>
<ul>
<li>View the fit</li>
</ul>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn_ex1)  <span class="co">#may suggest using a wider grid</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f5"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f5-1.png" alt="Grid plot" width="672" />
<p class="caption">
Figure 14.5: Grid plot
</p>
</div>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb370-1" aria-hidden="true" tabindex="-1"></a>knn_ex1</span></code></pre></div>
<pre><code>k-Nearest Neighbors 

434 samples
  6 predictor
  2 classes: &#39;0&#39;, &#39;1&#39; 

Pre-processing: centered (6), scaled (6) 
Resampling: Rolling Forecasting Origin Resampling (30 held-out with a fixed window) 
Summary of sample sizes: 250, 250, 250, 250, 250, 250, ... 
Resampling results across tuning parameters:

  k  Accuracy   Kappa    
  1  0.5898925  0.1554741
  3  0.6066667  0.1834679
  5  0.6419355  0.2500894
  7  0.6690323  0.3194890
  9  0.6686022  0.3209926

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 7.</code></pre>
<p><em>Variable importance can’t be obtained here as KNN does not produce a model</em></p>
<p><strong>Predictive Accuracy</strong></p>
<p>Let’s predict using the final model and assess using the confusion matrix.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb372-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">=</span> <span class="fu">predict</span>(knn_ex1, <span class="at">newdata =</span> d_test1)  <span class="co">#prediction on the test data</span></span>
<span id="cb372-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="at">data =</span> pred2, <span class="at">reference =</span> d_test1<span class="sc">$</span>Direction)</span></code></pre></div>
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 50 50
         1 18 68
                                          
               Accuracy : 0.6344          
                 95% CI : (0.5608, 0.7037)
    No Information Rate : 0.6344          
    P-Value [Acc &gt; NIR] : 0.5330295       
                                          
                  Kappa : 0.2833          
                                          
 Mcnemar&#39;s Test P-Value : 0.0001704       
                                          
            Sensitivity : 0.7353          
            Specificity : 0.5763          
         Pos Pred Value : 0.5000          
         Neg Pred Value : 0.7907          
             Prevalence : 0.3656          
         Detection Rate : 0.2688          
   Detection Prevalence : 0.5376          
      Balanced Accuracy : 0.6558          
                                          
       &#39;Positive&#39; Class : 0               
                                          </code></pre>
<ul>
<li><p>A comparison betweek Logistic Regression and KNN can be made based on their predictive accuracy.</p></li>
<li><p>The two models can also be compared based on their resampling results.</p></li>
<li><p>The random number seeds should be initialised to the same value for resampling comparison.</p></li>
<li><p>The following code compares the model fits.</p></li>
</ul>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb374-1" aria-hidden="true" tabindex="-1"></a>resamp1 <span class="ot">=</span> <span class="fu">resamples</span>(<span class="fu">list</span>(<span class="at">logit =</span> logit_ex1, <span class="at">knn =</span> knn_ex1))</span>
<span id="cb374-2"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb374-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-3"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb374-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resamp1)</span></code></pre></div>
<pre><code>
Call:
summary.resamples(object = resamp1)

Models: logit, knn 
Number of resamples: 155 

Accuracy 
           Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
logit 0.4666667 0.6666667 0.7333333 0.7324731 0.8000000 0.9000000    0
knn   0.4333333 0.5666667 0.6666667 0.6690323 0.7666667 0.8666667    0

Kappa 
            Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
logit  0.1208791 0.3333333 0.4666667 0.4658076 0.5838144 0.7887324    0
knn   -0.1860465 0.1558442 0.3243243 0.3194890 0.4666667 0.7235023    0</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="14.3-forecasting-stock-price-movement-using-ml.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(resamp1, <span class="at">metric =</span> <span class="st">&quot;Accuracy&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ex1f6"></span>
<img src="04-Part_3_logistic_files/figure-html/ex1f6-1.png" alt="Resample Accuracy comparison" width="672" />
<p class="caption">
Figure 14.6: Resample Accuracy comparison
</p>
</div>
<ul>
<li>The graph provides a comparison of the overall accuracy of the model (not the predictions).</li>
</ul>

</div>
</div>
<!-- </div> -->
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Shynkevich2017" class="csl-entry">
Shynkevich, Yauheniya, T. M. McGinnity, Sonya A. Coleman, Ammar Belatreche, and Yuhua Li. 2017. <span>“Forecasting Price Movements Using Technical Indicators: Investigating the Impact of Varying Input Window Length.”</span> <em>Neurocomputing</em> 264: 71–88. https://doi.org/<a href="https://doi.org/10.1016/j.neucom.2016.11.095">https://doi.org/10.1016/j.neucom.2016.11.095</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="14.2-k-nearest-neighbour.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="15-decision-trees-using-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
